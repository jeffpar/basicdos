#
# BASIC-DOS Makefile
#
# @author Jeff Parsons <Jeff@pcjs.org>
# @copyright (c) 2020-2021 Jeff Parsons
# @license MIT <https://basicdos.com/LICENSE.txt>
#
# This file is part of PCjs, a computer emulation software project at pcjs.org
#
ASM=MASM
LINK=LINK
AFLAGS=/D$(REL) /I.
MAPSYM=MAPSYM

#
# Inference rules in the DOS MAKE utility apparently work only if the files
# are in the same folder.  So for now, each dependency must copy these rules.
#
.ASM.OBJ:
	$(ASM) $(AFLAGS) $*.ASM,$@,$*.LST;

OBJ\GWDATA.OBJ: GWDATA.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GWMAIN.OBJ: GWMAIN.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\OEM.OBJ: OEM.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GWEVAL.OBJ: GWEVAL.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GWLIST.OBJ: GWLIST.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\IBMRES.OBJ: IBMRES.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\BIMISC.OBJ: BIMISC.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\DSKCOM.OBJ: DSKCOM.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\BIPTRG.OBJ: BIPTRG.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\BIPRTU.OBJ: BIPRTU.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\BISTRS.OBJ: BISTRS.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\FIVEO.OBJ: FIVEO.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GENGRP.OBJ: GENGRP.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\ADVGRP.OBJ: ADVGRP.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\MACLNG.OBJ: MACLNG.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GWSTS.OBJ: GWSTS.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIO86.OBJ: GIO86.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIODSK.OBJ: GIODSK.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOKYB.OBJ: GIOKYB.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOSCN.OBJ: GIOSCN.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOLPT.OBJ: GIOLPT.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOCOM.OBJ: GIOCOM.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOCON.OBJ: GIOCON.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOTBL.OBJ: GIOTBL.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\SCNEDT.OBJ: SCNEDT.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\SCNDRV.OBJ: SCNDRV.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\CALL86.OBJ: CALL86.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\NEXT86.OBJ: NEXT86.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\MATH.OBJ: MATH.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\KANJ86.OBJ: KANJ86.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GIOCAS.OBJ: GIOCAS.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\ITSA86.OBJ: ITSA86.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GWRAM.OBJ: GWRAM.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\GWINIT.OBJ: GWINIT.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\BIBOOT.OBJ: BIBOOT.ASM OEM.INC
	$(ASM) $(AFLAGS) $*.ASM,$@,OBJ\$*.LST;

OBJ\MSBASIC.EXE: OBJ\GWDATA.OBJ OBJ\GWMAIN.OBJ OBJ\OEM.OBJ OBJ\GWEVAL.OBJ \
	OBJ\GWLIST.OBJ OBJ\IBMRES.OBJ OBJ\BIMISC.OBJ OBJ\DSKCOM.OBJ \
	OBJ\BIPTRG.OBJ OBJ\BIPRTU.OBJ OBJ\BISTRS.OBJ OBJ\FIVEO.OBJ \
	OBJ\GENGRP.OBJ OBJ\ADVGRP.OBJ OBJ\MACLNG.OBJ OBJ\GWSTS.OBJ \
	OBJ\GIO86.OBJ OBJ\GIODSK.OBJ OBJ\GIOKYB.OBJ OBJ\GIOSCN.OBJ \
	OBJ\GIOLPT.OBJ OBJ\GIOCOM.OBJ OBJ\GIOCON.OBJ OBJ\GIOTBL.OBJ \
	OBJ\SCNEDT.OBJ OBJ\SCNDRV.OBJ OBJ\CALL86.OBJ OBJ\NEXT86.OBJ \
	OBJ\MATH.OBJ OBJ\KANJ86.OBJ OBJ\GIOCAS.OBJ OBJ\ITSA86.OBJ \
	OBJ\GWRAM.OBJ OBJ\GWINIT.OBJ OBJ\BIBOOT.OBJ MSBASIC.LRF MSBASIC.PAT
	$(LINK) @$*.LRF
	CD OBJ
	REN MSBASIC.EXE MSBASIC.TMP
	SYMDEB MSBASIC.TMP < ..\MSBASIC.PAT
	REN MSBASIC.TMP MSBASIC.EXE
	$(MAPSYM) $*
	CD ..
